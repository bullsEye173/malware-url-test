package com.cisco.security.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.cisco.security.jpa.repository.UrlJpaRepository;
import com.cisco.security.model.Url;
import com.cisco.security.repository.UrlRepository;

@Service
public class UrlService {

	@Autowired
	private UrlRepository repository;

	@Autowired
	private UrlJpaRepository jpaRepository;

	public Url save(Url url) {
		List<Url> urls = repository.findByHostAndPortAndPathAndQuery(url.getHost(), url.getPort(), url.getPath(),
				url.getQuery());
		//if the url is not malicious
		if (urls.isEmpty()) {
			// first persist the data into H2 db
			Url pUrl = jpaRepository.save(url);
			return pUrl;
		}
		return null;

	}

	public List<Url> find(String host, Integer port, String path, String query) {
		List<Url> urls = repository.findByHostAndPortAndPathAndQuery(host, port, path, query);
		if (urls.isEmpty()) {
			urls = jpaRepository.findByHostAndPortAndPathAndQuery(host, port, path, query);
		}
		return urls;
	}

	public List<Url> findAll() {
		List<Url> usersList = new ArrayList<>();
		Iterable<Url> userses = jpaRepository.findAll();
		userses.forEach(usersList::add);
		return usersList;
	}

}
